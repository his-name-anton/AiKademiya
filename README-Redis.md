# Redis –≤ AI Akademiya - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

‚úÖ **Redis —Å–µ—Ä–≤–∏—Å** –≤ Docker Compose  
‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ API** –∫—É—Ä—Å–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–∞—Ç–µ–≥–æ—Ä–∏–π  
‚úÖ **Rate limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞  
‚úÖ **–°–µ—Å—Å–∏–∏ –≤ Redis** –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** –∫–µ—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö  

## –ó–∞–ø—É—Å–∫

```bash
# –ü–æ–¥–Ω—è—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–∫–ª—é—á–∞—è Redis
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Redis –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
docker-compose ps redis
docker-compose logs redis
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞
docker exec aikademiya-backend python manage.py clear_cache --stats

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ API (–¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞—Å—Ç—å –≤ –∫–µ—à)
curl http://localhost:8000/api/categories/
```

### –ê–¥–º–∏–Ω–∫–∞ Redis

1. –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É: http://localhost:8000/admin/
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤: http://localhost:8000/admin/redis-stats/
3. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–µ—à–µ–º

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º

```bash
# –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à
docker exec aikademiya-backend python manage.py clear_cache --all

# –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –∫—É—Ä—Å–æ–≤
docker exec aikademiya-backend python manage.py clear_cache --pattern "course:*"

# –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
docker exec aikademiya-backend python manage.py clear_cache --pattern "user:123:*"
```

## –ß—Ç–æ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è

| –î–∞–Ω–Ω—ã–µ | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ | –¢—Ä–∏–≥–≥–µ—Ä –æ—á–∏—Å—Ç–∫–∏ |
|--------|-------------|-----------------|
| –°–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤ | 10 –º–∏–Ω | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫—É—Ä—Å–∞ |
| –î–µ—Ç–∞–ª–∏ –∫—É—Ä—Å–∞ | 30 –º–∏–Ω | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫—É—Ä—Å–∞/–º–æ–¥—É–ª—è |
| –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ | 30 –º–∏–Ω | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |
| –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | 15 –º–∏–Ω | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è |
| –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | 1 —á–∞—Å | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |

## Rate Limiting

- **API –∑–∞–ø—Ä–æ—Å—ã**: 100/—á–∞—Å —Å IP
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: 20/—á–∞—Å —Å IP  
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—É—Ä—Å–æ–≤**: 10/—á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è**: 20/—á–∞—Å —Å IP

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –í –±—Ä–∞—É–∑–µ—Ä–µ
- –ê–¥–º–∏–Ω–∫–∞: http://localhost:8000/admin/redis-stats/

### –ß–µ—Ä–µ–∑ API –∑–∞–≥–æ–ª–æ–≤–∫–∏
- `X-Cache-Hits` - –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫–µ—à
- `X-Cache-Misses` - –ø—Ä–æ–º–∞—Ö–∏ –∫–µ—à–∞  
- `X-Response-Time` - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

### –õ–æ–≥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (>1—Å–µ–∫) –≤ –ª–æ–≥–∞—Ö Django
docker-compose logs web | grep "–ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å"
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis

–í `docker-compose.yml`:
- **–ü–∞–º—è—Ç—å**: 512MB —Å LRU –ø–æ–ª–∏—Ç–∏–∫–æ–π
- **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: AOF –≤–∫–ª—é—á–µ–Ω
- **–°–µ—Ç—å**: –¢–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```
REDIS_URL=redis://redis:6379/1
```

## Troubleshooting

### Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose ps redis
docker-compose logs redis

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose restart redis
```

### –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
```bash
# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
docker exec aikademiya-backend python manage.py clear_cache --all

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –≤ docker-compose.yml
command: redis-server --maxmemory 1024mb
```

### –ù–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Hit Rate –≤ –∞–¥–º–∏–Ω–∫–µ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >80%)
2. –£–≤–µ–ª–∏—á—å—Ç–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

üìñ **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [`docs/redis-integration.md`](docs/redis-integration.md)

üîß **–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**:
```python
from core.redis_utils import CourseCache, UserCache
from core.decorators import cache_api_response
```

üöÄ **–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É** —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º